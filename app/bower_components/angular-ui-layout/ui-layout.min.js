"use strict";angular.module("ui.layout",[]).controller("uiLayoutCtrl",["$scope","$attrs","$element",function($scope,$attrs,$element){return{opts:angular.extend({},$scope.$eval($attrs.uiLayout),$scope.$eval($attrs.options)),element:$element}}]).directive("uiLayout",["$parse",function($parse){function convertNumericDataTypesToPencents(numberVairousTypeArray,minSizes,maxSizes,parentSize){var _i,_n,_res=[];_res.length=numberVairousTypeArray.length;var _commonSizeIndex=[],_minSizes=[],_maxSizes=[],_remainingSpace=100;for(_i=0,_n=numberVairousTypeArray.length;_n>_i;++_i){var minSize=parseInt(minSizes[_i],10);if(minSize){var minType=minSizes[_i].match(/\d+\s*(px|%)\s*$/i);!isNaN(minSize)&&minType&&minType.length>1&&"px"===minType[1]&&(minSize=+(minSize/parentSize*100).toFixed(5))}_minSizes.push(minSize);var maxSize=parseInt(maxSizes[_i],10);if(maxSize){var maxType=maxSizes[_i].match(/\d+\s*(px|%)\s*$/i);!isNaN(maxSize)&&maxType&&maxType.length>1&&"px"===maxType[1]&&(maxSize=+(maxSize/parentSize*100).toFixed(5))}_maxSizes.push(maxSize);var rawSize=numberVairousTypeArray[_i],value=parseInt(rawSize,10),type=rawSize.match(/\d+\s*(px|%)\s*$/i);!isNaN(value)&&type?(type.length>1&&"px"===type[1]&&(value=+(value/parentSize*100).toFixed(5)),minSize&&(value=Math.max(value,minSize)),maxSize&&(value=Math.min(value,maxSize)),_res[_i]=value,_remainingSpace-=value):rawSize="auto",/^\s*auto\s*$/.test(rawSize)&&_commonSizeIndex.push(_i)}if(_commonSizeIndex.length>0){var _commonSize=_remainingSpace/_commonSizeIndex.length,_modifiedSizeIndex=[];for(_i=0,_n=_commonSizeIndex.length;_n>_i;++_i){var _cid=_commonSizeIndex[_i],_minSize=_minSizes[_cid],_maxSize=_maxSizes[_cid];_minSize>=_commonSize?(_remainingSpace-=_minSize,_res[_cid]=_minSize):_commonSize>=_maxSize?(_remainingSpace-=_maxSize,_res[_cid]=_maxSize):_modifiedSizeIndex.push(_cid)}for(_commonSize=_remainingSpace/_modifiedSizeIndex.length,_i=0,_n=_modifiedSizeIndex.length;_n>_i;++_i){var cid=_modifiedSizeIndex[_i];null!==cid&&(_res[cid]=_commonSize)}}return _res}var splitBarElem_htmlTemplate='<div class="stretch ui-splitbar"></div>';return{restrict:"AE",compile:function(tElement,tAttrs){var _i,_sizes,_position,_childens=tElement.children(),_child_len=_childens.length,opts=angular.extend({},$parse(tAttrs.uiLayout)(),$parse(tAttrs.options)()),isUsingColumnFlow="column"===opts.flow;for(tElement.addClass("stretch").addClass("ui-layout-"+(opts.flow||"row")),opts.sizes=opts.sizes||[],opts.maxSizes=opts.maxSizes||[],opts.minSizes=opts.minSizes||[],opts.dividerSize=opts.dividerSize||"10px",opts.sizes.length=_child_len,_i=0;_child_len>_i;++_i)angular.element(_childens[_i]).addClass("stretch"),opts.sizes[_i]=angular.element(_childens[_i]).attr("size")||opts.sizes[_i]||"auto",opts.maxSizes[_i]=angular.element(_childens[_i]).attr("max-size")||opts.maxSizes[_i]||null,opts.minSizes[_i]=angular.element(_childens[_i]).attr("min-size")||opts.minSizes[_i]||null;if(_sizes=convertNumericDataTypesToPencents(opts.sizes,opts.minSizes,opts.maxSizes,tElement[0]["offset"+(isUsingColumnFlow?"Width":"Height")]),_child_len>1){var flowProperty=isUsingColumnFlow?"left":"top",oppositeFlowProperty=isUsingColumnFlow?"right":"bottom",sizeProperty=isUsingColumnFlow?"width":"height";for(_position=0,_i=0;_child_len>_i;++_i){var area=angular.element(_childens[_i]).css(flowProperty,_position+"%");if(_position+=_sizes[_i],area.css(oppositeFlowProperty,100-_position+"%"),_child_len-1>_i){var bar=angular.element(splitBarElem_htmlTemplate).css(flowProperty,_position+"%");bar.css(sizeProperty,opts.dividerSize),area.after(bar)}}}},controller:"uiLayoutCtrl"}}]).directive("uiSplitbar",function(){var htmlElement=angular.element(document.body.parentElement);return{require:"^uiLayout",restrict:"EAC",link:function(scope,iElement,iAttrs,parentLayout){function _cached_layout_values(){var layout_bb=parentLayout.element[0].getBoundingClientRect(),bar_bb=barElm.getBoundingClientRect();_cache.time=+new Date,_cache.barSize=bar_bb[sizeProperty],_cache.layoutSize=layout_bb[sizeProperty],_cache.layoutOrigine=layout_bb[flowProperty],_cache.previousElement=previousElement.getBoundingClientRect(),_cache.previousElement.min=parseInt(previousElement.getAttribute("min-size"),10),_cache.previousElement.max=parseInt(previousElement.getAttribute("max-size"),10),_cache.nextElement=nextElement.getBoundingClientRect(),_cache.nextElement.min=parseInt(nextElement.getAttribute("min-size"),10),_cache.nextElement.max=parseInt(nextElement.getAttribute("max-size"),10);var dividerSize=isNaN(bar_bb[sizeProperty])?bar_bb[sizeProperty]:bar_bb[sizeProperty]+"px",_dividerSize=parseInt(dividerSize,10),_dividerType=dividerSize.match(/\d+\s*(px|%)\s*$/i);if(!isNaN(_dividerSize)&&_dividerType&&_dividerType.length>1&&"px"===_dividerType[1]&&(_dividerSize=+(_dividerSize/_cache.layoutSize*100).toFixed(5)),_cache.previousElement.min){var minType=previousElement.getAttribute("min-size").match(/\d+\s*(px|%)\s*$/i);!isNaN(_cache.previousElement.min)&&minType&&minType.length>1&&"px"===minType[1]&&(_cache.previousElement.min=+(_cache.previousElement.min/_cache.layoutSize*100).toFixed(5)),_dividerSize&&_cache.previousElement.min<_dividerSize&&(_cache.previousElement.min=_dividerSize)}else _cache.previousElement.min=_dividerSize;if(_cache.previousElement.max){var maxType=previousElement.getAttribute("max-size").match(/\d+\s*(px|%)\s*$/i);!isNaN(_cache.previousElement.max)&&maxType&&maxType.length>1&&"px"===maxType[1]&&(_cache.previousElement.max=+(_cache.previousElement.max/_cache.layoutSize*100).toFixed(5))}if(_cache.nextElement.min){var _minType=nextElement.getAttribute("min-size").match(/\d+\s*(px|%)\s*$/i);!isNaN(_cache.nextElement.min)&&_minType&&_minType.length>1&&"px"===_minType[1]&&(_cache.nextElement.min=+(_cache.nextElement.min/_cache.layoutSize*100).toFixed(5)),_dividerSize&&_cache.nextElement.min<_dividerSize&&(_cache.nextElement.min=_dividerSize)}else _cache.nextElement.min=_dividerSize;if(_cache.nextElement.max){var _maxType=nextElement.getAttribute("max-size").match(/\d+\s*(px|%)\s*$/i);!isNaN(_cache.nextElement.max)&&_maxType&&_maxType.length>1&&"px"===_maxType[1]&&(_cache.nextElement.max=+(_cache.nextElement.max/_cache.layoutSize*100).toFixed(5))}}function _draw(){var the_pos=(lastX-_cache.layoutOrigine)/_cache.layoutSize*100;the_pos=Math.min(the_pos,100-_cache.barSize/_cache.layoutSize*100);var previousElementValue=_cache.previousElement[flowProperty]/_cache.layoutSize*100;!isNaN(_cache.previousElement.min)&&the_pos<previousElementValue+_cache.previousElement.min&&(the_pos=previousElementValue+_cache.previousElement.min),!isNaN(_cache.previousElement.max)&&the_pos>previousElementValue+_cache.previousElement.max&&(the_pos=previousElementValue+_cache.previousElement.max);var nextElementValue=(_cache.nextElement[flowProperty]+_cache.nextElement[sizeProperty])/_cache.layoutSize*100,nextElementMinValue=nextElementValue-_cache.nextElement.min,nextElementMaxValue=nextElementValue-_cache.nextElement.max;!isNaN(_cache.nextElement.max)&&nextElementMaxValue>the_pos&&(the_pos=nextElementMaxValue),!isNaN(_cache.nextElement.min)&&the_pos>nextElementMinValue&&(the_pos=nextElementMinValue),the_pos=Math.max(the_pos,parseInt(barElm.previousElementSibling.style[flowProperty],10)),barElm.nextElementSibling.nextElementSibling&&(the_pos=Math.min(the_pos,parseInt(barElm.nextElementSibling.nextElementSibling.style[flowProperty],10))),barElm.style[flowProperty]=barElm.nextElementSibling.style[flowProperty]=the_pos+"%",barElm.previousElementSibling.style[oppositeFlowProperty]=100-the_pos+"%",animationFrameRequested=null}function _resize(mouseEvent){lastX=mouseEvent[mouseProperty]||mouseEvent.originalEvent&&mouseEvent.originalEvent[mouseProperty]||(mouseEvent.targetTouches?mouseEvent.targetTouches[0][mouseProperty]:0),animationFrameRequested&&window.cancelAnimationFrame(animationFrameRequested),(!_cache.time||+new Date>_cache.time+1e3)&&_cached_layout_values(),animationFrameRequested=window.requestAnimationFrame(_draw)}var animationFrameRequested,lastX,_cache={},isUsingColumnFlow="column"===parentLayout.opts.flow,mouseProperty=isUsingColumnFlow?"clientX":"clientY",flowProperty=isUsingColumnFlow?"left":"top",oppositeFlowProperty=isUsingColumnFlow?"right":"bottom",sizeProperty=isUsingColumnFlow?"width":"height",barElm=iElement[0],previousElement=barElm.previousElementSibling,nextElement=barElm.nextElementSibling;iElement.on("mousedown touchstart",function(e){return e.preventDefault(),e.stopPropagation(),htmlElement.on("mousemove touchmove",_resize),!1}),htmlElement.on("mouseup touchend",function(){htmlElement.off("mousemove touchmove")})}}});